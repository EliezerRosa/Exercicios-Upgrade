<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprenda Fazendo - Editor de Código</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/theme/monokai.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f0f0f0;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #333;
            color: white;
        }

        .top-bar button, .top-bar select {
            background-color: #555;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }

        .top-bar button:hover, .top-bar select:hover {
            background-color: #777;
        }

        .editor-section {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
        }

        .code-editors {
            display: flex;
            flex-direction: column;
            flex: 1;
            max-width: calc(100vw - 400px); /* Ajuste para largura mínima do preview */
            border-right: 1px solid #ccc;
            overflow-y: auto; /* Scroll vertical para os editores */
        }


        .editor {
            flex: 1;
            padding: 10px;
            overflow: hidden; /* Para evitar que o conteúdo vaze */
            display: flex;
            flex-direction: column;
            border-bottom: 1px solid #ccc;
        }

        .editor h3 {
            margin: 0 0 10px;
            color: #333;
        }

        .CodeMirror {
            height: auto !important;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            flex-grow: 1; /* Ocupar o espaço disponível dentro do editor */
            margin-bottom: 10px;
            font-size: 14px;
        }

        .editor.expanded {
            position: absolute;
            width: 80%;
            height: 80%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001;
            background: #f4f4f4;
            border: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor.expanded .CodeMirror {
            height: 100% !important;
        }

        .preview {
             flex-basis: 400px; /* Largura mínima do preview */
            flex-grow: 1;
            border-left: 1px solid #ccc;
            overflow: hidden;
            background-color: white; /* Fundo branco para o preview */

        }

        #previewFrame {
            width: 100%;
            height: 100%;
            border: none;
        }


         .buttons {
            margin-top: 10px;
            display: flex;
            justify-content: flex-start; /* Alinha os botões à esquerda */
            margin-bottom: 10px; /* Adiciona espaçamento abaixo do grupo de botões */
        }

        .buttons button {
            background-color: #555;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }

        .buttons button:hover {
            background-color: #777;
        }
        #error-display {
            max-height: 100px;
            overflow-y: auto;
            color: red;
            font-weight: bold;
            padding: 10px;
            border: 1px solid red;
            margin-top: 10px;
            display: none;
            background-color: #fdd;

        }

         .all-code-editor {
            position: absolute;
            width: 80%;
            height: 80%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1002;
            background: #f4f4f4;
            border: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
            .all-code-editor .CodeMirror {
                width: 100%;
                height: 100%;
                max-height: none;
            }


        @media (max-width: 768px) {
            .editor-section {
                flex-direction: column;
            }
            .code-editors {
                max-width: 100%;
                border-right: none;

            }
            .preview {
                 flex-basis: auto;
                border-left: none;
            }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <button onclick="loadExample(0)">Exemplo 1</button>
        <button onclick="loadExample(1)">Exemplo 2</button>
        <button onclick="loadExample(2)">Exemplo 3</button>
        <button onclick="openPreviewTab()">Abrir em Nova Aba</button>
        <button onclick="expandAllCode()">Ver Todo o Código</button>
        <select onchange="loadAI(this.value)">
            <option value="">IA Tutor</option>
            <option value="https://chat.openai.com">ChatGPT</option>
            <option value="https://web.whatsapp.com/send?phone=13135550002">Meta AI</option>
            <option value="https://gemini.google.com">Gemini</option>
            <option value="https://aistudio.google.com">Google AI Studio</option>
            <option value="https://x.com/i/grok">Grok</option>
        </select>
		<select onchange="loadCourse(this.value)">
            <option value="">Plataforma Curso</option>
            <option value="https://pt.khanacademy.org/computing/computer-programming/programming/intro-to-programming/v/programming-intro">Khan Academy Português</option>
            <option value="https://www.cursoemvideo.com/">Professor Guanabara Português</option>
            <option value="https://www.primecursos.com.br/programacao/">Prime Cursos Português</option>
            <option value="https://www.udemy.com/course/programacao-para-iniciantes-aprenda-programar-do-zero/?utm_source=adwords&utm_medium=udemyads&utm_campaign=MX_FF-CONV_BR_Search-NB_DSA_GammaCatchall_la.PT_Google&campaigntype=Search&portfolio=Brazil&language=PT&product=Course&test=&audience=DSA&topic=&priority=Gamma&funnel=Conversion&utm_content=&utm_term=_._ag_171903008064_._ad_706479958704_._kw__._de_c_._dm__._pl__._ti_dsa-1456167871416_._li_9101057_._pd__._&matchtype=&gad_source=1&gclid=CjwKCAiA1eO7BhATEiwAm0Ee-ArmsHzCdgbf1JW5EWhOCPf78MztvJdQ6Az4pHt7BEo0Vxp7tz_uoRoCeHUQAvD_BwE">Udemy Português</option>
            <option value="https://www.edx.org/learn/how-to-learn/edx-how-to-learn-online">edX Inglês</option>
            <option value="https://www.codecademy.com/learn">Codecademy Inglês</option>
            <option value="https://www.w3schools.com/">w3schools Inglês</option>
            <option value="https://www.sololearn.com/pt/onboarding">sololearn Português</option>
        </select>
		 <button onclick="saveCode()">Salvar</button>
        <button onclick="loadCode()">Carregar</button>
        <button onclick="exportCode()">Exportar</button>
    </div>

    <div class="editor-section">
        <div class="code-editors">
            <div class="editor" id="css-editor">
                <h3>CSS</h3>
                <div class="buttons">
					<button onclick="expandEditor('css')">Expandir/Recolher</button>
				</div>
                 <textarea id="css-code"></textarea>
            </div>
            <div class="editor" id="html-editor">
                <h3>HTML</h3>
                <div class="buttons">
					 <button onclick="expandEditor('html')">Expandir/Recolher</button>
				</div>
                <textarea id="html-code"></textarea>
            </div>
            <div class="editor" id="js-editor">
                <h3>JavaScript</h3>
				 <div class="buttons">
					<button onclick="expandEditor('js')">Expandir/Recolher</button>
				</div>
                <textarea id="js-code"></textarea>
            </div>
        </div>
       <div class="preview" id="preview">
            <iframe id="previewFrame" sandbox="allow-scripts allow-same-origin" style="width:100%; height:100%; border:none;"></iframe>
        </div>
    </div>
	 <div id="error-display"></div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/addon/selection/active-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.13.6/jshint.min.js"></script>
   
    <script>
       const examples = [
            {
                css: `body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
                        input, button { margin: 10px; padding: 10px; width: calc(100% - 40px); max-width: 300px; }
                        button { background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
                        button:hover { background-color: #0056b3; }
                        #resultado { font-size: 1.2em; margin-top: 20px; color: #333; }`,
                html: `<div> <h1>Calculadora</h1>
                        <input type="number" id="num1" placeholder="Digite o primeiro número" aria-label="Primeiro número">
                        <input type="number" id="num2" placeholder="Digite o segundo número" aria-label="Segundo número">
                    </div>
                    <div>
                        <button onclick="somar()">Somar</button>
                        <button onclick="limpar()">Limpar</button>
                        <p id="resultado"></p>
                    </div>`,
                js: `function somar() {
                        const num1 = parseFloat(document.getElementById('num1').value);
                        const num2 = parseFloat(document.getElementById('num2').value);
                        const resultado = num1 + num2;
                        const campoResultado = document.getElementById('resultado');

                        if (isNaN(resultado)) {
                            campoResultado.innerText = 'Insira números válidos.';
                            campoResultado.style.color = 'red';
                        } else {
                            campoResultado.innerText = 'Resultado: ' + resultado;
                            campoResultado.style.color = 'green';
                        }
                    }
                    function limpar() {
                        document.getElementById('num1').value = '';
                        document.getElementById('num2').value = '';
                        document.getElementById('resultado').innerText = '';
                    }`
            },
              {
                css: `
				body {
					font-family: sans-serif;
					background: #f0f0f0;
					display: flex;
					justify-content: center;
					align-items: center;
					min-height: 100vh;
					margin: 0;
				}
				.container {
					background: white;
					padding: 20px;
					border-radius: 8px;
					box-shadow: 0 2px 4px rgba(0,0,0,0.1);
					text-align: center;
				}
				button {
					background: #007bff;
					color: white;
					border: none;
					padding: 10px 20px;
					border-radius: 5px;
					cursor: pointer;
					margin: 10px;
					transition: background-color 0.3s;
				}
				button:hover {
					background: #0056b3;
				}
				#timer {
					font-size: 2em;
					margin-bottom: 20px;
				}
				`,
                html: `<div class="container">
					<div id="timer">00:00:00</div>
					<button id="start">Iniciar</button>
					<button id="pause" disabled>Pausar</button>
					<button id="reset">Reset</button>
				</div>`,
                js: `
				let timerInterval;
				let seconds = 0;
				let isPaused = true;

				function updateDisplay() {
					const display = document.getElementById('timer');
					const hours = String(Math.floor(seconds / 3600)).padStart(2, '0');
					const minutes = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
					const secs = String(seconds % 60).padStart(2, '0');
					display.innerText = \`\${hours}:\${minutes}:\${secs}\`;
				}

				function startTimer() {
					if (isPaused) {
						isPaused = false;
						document.getElementById('start').disabled = true;
						document.getElementById('pause').disabled = false;
						timerInterval = setInterval(() => {
							seconds++;
							updateDisplay();
						}, 1000);
					}
				}

				function pauseTimer() {
					if (!isPaused) {
						isPaused = true;
						document.getElementById('start').disabled = false;
						document.getElementById('pause').disabled = true;
						clearInterval(timerInterval);
					}
				}
				function resetTimer() {
					isPaused = true;
					document.getElementById('start').disabled = false;
					document.getElementById('pause').disabled = true;
					clearInterval(timerInterval);
					seconds = 0;
					updateDisplay();
				}
				document.getElementById('start').addEventListener('click', startTimer);
				document.getElementById('pause').addEventListener('click', pauseTimer);
				document.getElementById('reset').addEventListener('click', resetTimer);
				`
            },
			{
                css: `
				body {
					font-family: sans-serif;
					display: flex;
					justify-content: center;
					align-items: center;
					min-height: 100vh;
					background-color: #f4f4f4;
					margin: 0;
				}

				.card {
					background-color: #fff;
					border-radius: 8px;
					box-shadow: 0 4px 8px rgba(0,0,0,0.1);
					padding: 20px;
					width: 300px;
					text-align: center;
				}

				img {
					max-width: 100%;
					height: auto;
					border-radius: 50%;
					margin-bottom: 15px;
					border: 2px solid #3498db;
				}
				h2 {
					color: #333;
					margin-bottom: 10px;
				}

				p {
					color: #555;
					margin-bottom: 15px;
				}
                button {
                    background-color: #3498db;
                    color: white;
                    border: none;
                    padding: 10px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                    transition: background-color 0.3s;
					margin: 5px;
                }
                button:hover {
                    background-color: #2980b9;
                }
				.buttons {
					margin-top: 10px;
					display: flex;
					justify-content: center;
				}
				`,
                html: `<div class="card">
					<img src="https://placekitten.com/200/200" alt="Profile Picture" id="profilePic">
					<h2 id="profileName">Nome do Perfil</h2>
					<p id="profileBio">Breve descrição do perfil.</p>
					<div class="buttons">
						<button onclick="updateProfile('gato', 'Gatinho', 'Miau!')">Gato</button>
						<button onclick="updateProfile('cachorro', 'Cachorro', 'Au Au!')">Cachorro</button>
					</div>
				</div>`,
                js: `function updateProfile(tipo, nome, bio) {
                    const profilePic = document.getElementById('profilePic');
					const profileName = document.getElementById('profileName');
					const profileBio = document.getElementById('profileBio');
                    if (tipo === 'gato') {
                        profilePic.src = 'https://placekitten.com/200/200';
                    } else {
                        profilePic.src = 'https://placedog.net/200/200';
                    }
					profileName.innerText = nome;
					profileBio.innerText = bio;
				}`
            }

        ];

		let htmlEditor, cssEditor, jsEditor;

        function initCodeMirror() {
            htmlEditor = CodeMirror.fromTextArea(document.getElementById('html-code'), {
                lineNumbers: true,
                mode: "xml",
                theme: "monokai",
                matchBrackets: true,
                styleActiveLine: true,
                lineWrapping: true
            });
            cssEditor = CodeMirror.fromTextArea(document.getElementById('css-code'), {
                lineNumbers: true,
                mode: "css",
                theme: "monokai",
                matchBrackets: true,
                styleActiveLine: true,
                lineWrapping: true
            });
            jsEditor = CodeMirror.fromTextArea(document.getElementById('js-code'), {
                lineNumbers: true,
                mode: "javascript",
                theme: "monokai",
                matchBrackets: true,
                styleActiveLine: true,
                lineWrapping: true
            });
        }

        function loadExample(index) {
            if (examples[index]) {
                cssEditor.setValue(examples[index].css);
                htmlEditor.setValue(examples[index].html);
                jsEditor.setValue(examples[index].js);
                updatePreview();
            }
        }
        async function loadHTMLHint() {
            return new Promise(resolve => {
            const htmlHintScript = document.createElement('script');
            htmlHintScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/htmlhint/1.1.3/htmlhint.min.js';
            htmlHintScript.onload = resolve;
            document.head.appendChild(htmlHintScript);
            });
        }
         function updatePreview() {
            const cssCode = cssEditor.getValue();
            const htmlCode = htmlEditor.getValue();
            const jsCode = jsEditor.getValue();

            const previewFrame = document.getElementById('previewFrame');
            const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;

            doc.open();
            doc.write(`
                ${htmlCode}
            `);
			const style = doc.createElement('style');
            style.textContent = cssCode;
            doc.head.appendChild(style);

            const script = doc.createElement('script');
            script.textContent = jsCode;
            doc.body.appendChild(script);

            doc.close();
             if (typeof HTMLHint !== 'undefined') {
                validateCode();
            } else {
                console.error("HTMLHint não está definido. Verifique se a biblioteca foi carregada corretamente.");
            }
        }

      function expandEditor(type) {
            const editor = document.getElementById(`${type}-editor`);
            if (editor.classList.contains('expanded')) {
                editor.classList.remove('expanded');
            } else {
                document.querySelectorAll('.editor').forEach(el => el.classList.remove('expanded'));
                editor.classList.add('expanded');
                if (type === 'js') jsEditor.refresh();
                else if (type === 'css') cssEditor.refresh();
                else if (type === 'html') htmlEditor.refresh();
            }
        }
         let aiWindow = null;

        function loadAI(url) {
            if (url) {
                const screenWidth = screen.availWidth;
                const screenHeight = screen.availHeight;

                const editorWidth = screenWidth * (3 / 4);
                const aiWidth = screenWidth * (1 / 4);

                window.resizeTo(editorWidth, screenHeight);

                setTimeout(() => {
                    aiWindow = window.open(url, "AIWindow", `width=${aiWidth},height=${screenHeight},left=${editorWidth},top=0`);

                    if (!aiWindow) {
                        alert("Popup blocked! Allow popups for this site.");
                    }
                }, 500);
            }
        }

        function openPreviewTab() {
            const htmlCode = htmlEditor.getValue();
            const cssCode = cssEditor.getValue();
            const jsCode = jsEditor.getValue();

            const newWindow = window.open();
            newWindow.document.write(`
                <style>${cssCode}</style>
                ${htmlCode}
                <script>${jsCode}<\/script>
            `);
        }


        function expandAllCode() {

            const previewFrame = document.getElementById('previewFrame');
            const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;

            const allCodeDiv = doc.createElement('div');
            allCodeDiv.className = 'all-code-editor';
            doc.body.appendChild(allCodeDiv);


             const combinedCode = '/* CSS */\n' + cssEditor.getValue() + '\n\n' +
                '/* HTML */\n' + htmlEditor.getValue() + '\n\n' +
                '/* JavaScript */\n' + jsEditor.getValue();


            const allCodeEditor = CodeMirror(allCodeDiv, {
                value: combinedCode,
                mode: "htmlmixed",
                theme: "monokai",
                lineNumbers: true,
                matchBrackets: true,
                styleActiveLine: true,
                lineWrapping: true,

            });

            const closeButton = doc.createElement('button');
            closeButton.textContent = 'Fechar';
            closeButton.style.position = 'absolute';
            closeButton.style.top = '10px';
            closeButton.style.right = '10px';
            closeButton.onclick = function () {
                doc.body.removeChild(allCodeDiv);
            };
            allCodeDiv.appendChild(closeButton);
        }



		let courseWindow = null;

        function loadCourse(url) {
            if (url) {
                const screenWidth = screen.availWidth;
                const screenHeight = screen.availHeight;

                const editorWidth = screenWidth * (3 / 4);
                const aiWidth = screenWidth * (1 / 4);

                window.resizeTo(editorWidth, screenHeight);

                setTimeout(() => {
                    courseWindow = window.open(url, "CourseWindow", `width=${aiWidth},height=${screenHeight},left=${editorWidth},top=0`);

                    if (!courseWindow) {
                        alert("Popup blocked! Allow popups for this site.");
                    }
                }, 500);
            }
        }

		 function saveCode() {
            const code = {
                css: cssEditor.getValue(),
                html: htmlEditor.getValue(),
                js: jsEditor.getValue()
            };
            localStorage.setItem('savedCode', JSON.stringify(code));
            alert('Código salvo!');
        }

        function loadCode() {
            const savedCode = localStorage.getItem('savedCode');
            if (savedCode) {
                const code = JSON.parse(savedCode);
                cssEditor.setValue(code.css);
                htmlEditor.setValue(code.html);
                jsEditor.setValue(code.js);
                updatePreview();
                alert('Código carregado!');
            } else {
                alert('Nenhum código salvo encontrado.');
            }
        }

		function exportCode() {
			 const code = {
                css: cssEditor.getValue(),
                html: htmlEditor.getValue(),
                js: jsEditor.getValue()
            };
			 const codeString = JSON.stringify(code, null, 2);
            const blob = new Blob([codeString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
            a.href = url;
            a.download = 'meu_codigo.json';
			document.body.appendChild(a);
            a.click();
			document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function validateCode() {
            const htmlCode = htmlEditor.getValue();
            const jsCode = jsEditor.getValue();

            let errorMessages = [];

            // Validate HTML
             if(typeof HTMLHint !== 'undefined'){
                const htmlHintResults = HTMLHint.verify(htmlCode);
                  htmlHintResults.forEach(error => {
                    errorMessages.push(`HTML: Line ${error.line}, Col ${error.col}: ${error.message} (Regra: ${error.rule.id})`);
                });
            }
			 try {
                // Validate JavaScript using JSHint
                const jshintResults = JSHINT(jsCode);
                 if (jshintResults) {
                     JSHINT.errors.forEach(error => {
                        if (error) {
                           errorMessages.push(`JS: Line ${error.line}, Col ${error.character}: ${error.reason}`);
                         }
                  });
                }
            } catch (e) {
                errorMessages.push(`Erro ao validar JS: ${e.message}`);
            }

          const errorDisplay = document.getElementById('error-display');
           if (errorMessages.length > 0) {
               errorDisplay.style.display = 'block';
               errorDisplay.innerHTML = '<h2>Erros encontrados:</h2><p>' + errorMessages.join('</p><p>') + '</p>';
           } else {
              errorDisplay.style.display = 'none';
               errorDisplay.innerHTML = '';
           }
       }


	    document.addEventListener('DOMContentLoaded', async function () {
            initCodeMirror();
           await loadHTMLHint();
           loadExample(0);
			// Listen for changes in any editor to update the preview and potentially the all-code view
            htmlEditor.on('change', function() {
                 updatePreview();
                  if (document.querySelector('.all-code-editor')) {
                     // Verificar se o editor de todo o código está aberto
                     const previewFrame = document.getElementById('previewFrame');
                      const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                     if(doc.querySelector('.all-code-editor')){
						 expandAllCode();
					 }

                }
            });
             cssEditor.on('change', function() {
                updatePreview();
                if (document.querySelector('.all-code-editor')) {
                    const previewFrame = document.getElementById('previewFrame');
                      const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                      if(doc.querySelector('.all-code-editor')){
						 expandAllCode();
					 }
                }
            });
             jsEditor.on('change', function() {
                 updatePreview();
                  if (document.querySelector('.all-code-editor')) {
                     const previewFrame = document.getElementById('previewFrame');
                      const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                      if(doc.querySelector('.all-code-editor')){
						 expandAllCode();
					 }
                }
            });
        });
    </script>
</body>
</html>
